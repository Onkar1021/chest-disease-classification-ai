<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Chest Disease Classification</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<style>
	body{background-color:#eff2f9;}

	.iupload h3{
		color:#1b2d6b;
		font-size:32px;
		font-weight:700;
	}

	.img-part{margin:0 auto;}

	.image-part{
		height:320px;
		width:320px;
		border:2px solid #1b2d6b;
		border-radius:12px;
		overflow:hidden;
		margin:auto;
		background:white;
	}

	.image-part img,
	.image-part #video{
		height:100%;
		width:100%;
		object-fit:cover;
		padding:5px;
	}

	/* RESULT BOXES â€” PROFESSIONAL */
	.res-part{
		border:1px solid #dedede;
		min-height:360px;
		width:100%;
		padding:25px;
		margin:0 auto;
		background:white;
		border-radius:12px;
		box-shadow:0 4px 12px rgba(0,0,0,0.08);
		overflow:visible;
	}

	.res-part2{
		border:1px solid #dedede;
		min-height:360px;
		width:100%;
		padding:20px;
		margin:0 auto;
		background:white;
		border-radius:12px;
		box-shadow:0 4px 12px rgba(0,0,0,0.08);

		display:flex;
		align-items:center;
		justify-content:center;
	}

	.resp-img{
		max-width:100%;
		max-height:330px;
		border-radius:10px;
	}

	.btn-part{width:325px;margin:auto;}

	/* BUTTON STYLE */
	button.btn{
		border-radius:8px;
		font-weight:600;
	}

	/* LOADING OVERLAY */
	#loading{
		position:fixed;
		left:0;
		top:0;
		width:100%;
		height:100%;
		z-index:999999;
		background:rgba(255,255,255,0.7);
	}

	.loader{
		border:8px solid #f3f3f3;
		border-top:8px solid #363e75;
		border-radius:50%;
		width:60px;
		height:60px;
		position:absolute;
		top:50%;
		left:50%;
		transform:translate(-50%,-50%);
		animation:spin 1.2s linear infinite;
	}

	@keyframes spin{
		0%{transform:translate(-50%,-50%) rotate(0deg);}
		100%{transform:translate(-50%,-50%) rotate(360deg);}
	}

	.right-part{
		border:1px solid #dedede;
		padding:20px;
		border-radius:12px;
		background:#f9fbff;
	}
	/* ===== LEFT UPLOAD PANEL IMPROVEMENT ===== */

.img-part{
	display:flex;
	flex-direction:column;
	align-items:center;
	justify-content:center;
}

.image-part{
	box-shadow:0 6px 18px rgba(0,0,0,0.1);
	transition:transform 0.2s ease;
}

.image-part:hover{
	transform:scale(1.02);
}

.btn-part{
	width:320px;
	margin:25px auto 0 auto;

	display:flex;
	flex-direction:column;   
	gap:16px;                
	align-items:center;
}

.btn-part button{
	width:100%;              
	height:52px;
	font-size:17px;
	font-weight:600;
	border-radius:12px;
}

.btn-part button:hover{
	transform:translateY(-2px);
	box-shadow:0 8px 18px rgba(0,0,0,0.18);
}

/* Title Styling */
.iupload h3{
	margin-bottom:30px;
}

</style>
</head>
<body>
    <div class="main container">
		<section class="iupload">
			<h3 class="text-center py-4">End to End Chest Disease Classification</h3>
			<div class="row">
				<div class="img-part col-md-6">
					<div class="image-part">
						<video autoplay id="video" poster="https://img.freepik.com/free-vector/group-young-people-posing-photo_52683-18824.jpg?size=338&ext=jpg"></video>
						<img src="" id="photo">
						<canvas style="display:none;" id="canvas"></canvas>
					</div>
					<div class="btn-part">
						<form id="upload-data pt-3" class="">
							<div class="input-group mt-3 row">
								<button type="button" class="btn btn-primary" id="uload">Upload Image</button>
								<button id="send" type="button" class="btn btn-success">Predict Disease</button>

							</div>



							<input type="hidden" class="form-control mr-2" id="url" placeholder="Enter REST Api url..." value="../predict"/>
							<input name="upload" type="file" id="fileinput" style="position:absolute;top:-500px;"/><br/>
						</form>
					</div>
				</div>
				<div class="col-md-6 col-xs-12 right-part">
					<h5 class="mb-2"><center>Prediction Results</center></h5>
					<div class="row">
						<div class="res-part2 col-md-6 col-xs-12"></div>
						<div class="res-part col-md-6 col-xs-12"></div>
					</div>
				</div>
			</div>
		</section>
	</div>


<div id="loading"><div class="loader"></div></div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

<script>
var mybtn = document.getElementById('startbtn');
var myvideo = document.getElementById('video');
var mycanvas = document.getElementById('canvas');
var myphoto = document.getElementById('photo');
var base_data = "";

function sendRequest(base64Data){
	var type = "json";
	if(base64Data != "" || base64Data != null){
		if(type == "imgtobase"){
			$(".res-part").html("");
			$(".res-part").html(base64Data);
		}
		else if(type == "basetoimg"){
			var imageData = $("#imgstring").val();
			$(".res-part").html("");
			$(".res-part").append("<img src='data:image/jpeg;base64," + imageData + "' alt='' />");
		}
		else{
			var url = "/predict";
			$("#loading").show();
			$.ajax({
				url : url,
				type: "post",
				cache: false,
				async: true,
				crossDomain: true,
				headers: {
					'Content-Type': 'application/json',
					'Access-Control-Allow-Origin':'*'
				},
				data:JSON.stringify({image:base64Data}),
				success: function(res){
    $("#loading").hide();
    $(".res-part").html("");
    $(".res-part2").html("");

    var color = res.prediction === "Normal" ? "green" : "red";

    var progressBar = `
        <div style="margin-top:15px;">
            <div style="background:#ddd; width:100%; height:20px; border-radius:10px;">
                <div style="width:${parseFloat(res.confidence)}%;
                   background:${color}; height:20px; border-radius:10px; text-align:center; color:white;">
                    ${res.confidence}%
                </div>
            </div>
        </div>
    `;

    $(".res-part").html(
        `<h2 style="color:${color};">Prediction: ${res.prediction}</h2>
         <h4>Confidence:</h4>
         ${progressBar}
         <p style="margin-top:15px;">${res.explanation}</p>`
    );

    // Show uploaded image
    $(".res-part2").html(
        "<img class='resp-img' src='data:image/jpeg;base64," + base_data + "' alt='' style='max-width:100%; border-radius:10px;'/>"
    );
}
			});
		}
	}
}

$(document).ready(function(){
	$("#loading").hide();

	$('#send').click(function(evt){
		sendRequest(base_data);
    });

    $('#uload').click(function(evt) {
        $('#fileinput').focus().trigger('click');
    });
	$("#fileinput").change(function(){
		if (this.files && this.files[0]){
			var reader = new FileReader();
			reader.onload = function (e){
				var url = e.target.result;
				var img = new Image();
				img.crossOrigin = 'Anonymous';
				img.onload = function(){
					var canvas = document.createElement('CANVAS');
					var ctx = canvas.getContext('2d');
					canvas.height = this.height;
					canvas.width = this.width;
					ctx.drawImage(this, 0, 0);
					base_data = canvas.toDataURL('image/jpeg', 1.0).replace(/^data:image.+;base64,/, '');
					canvas = null;
				};
				img.src = url;
				$('#photo').attr('src', url);
				$('#photo').show();
				$('#video').hide();
			}
			reader.readAsDataURL(this.files[0]);
		}
	});
});

</script>
</body>
</html>